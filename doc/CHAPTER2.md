#Interworking with your SDN controller

MD-SAL is basically YANG datastore with DCN(pubsub) and RPC support.

If your SDN controller also follows this kind of data-driven architecture, it is possible to connect your SDN controller to MD-SAL via some kind of gateway:

```
[Your SDN controller]---pubsub(such as Redis)---[GW plugin]<-CRUD/DCN->[MD-SAL]

```

###Data-driven architecture
Usually, SDN controllers internally have datastore supporting pubsub:
- A combination of ZooKeeper and Cassandra
- A combination of Redis and another datastore
- Hazelcast
- MD-SAL
- And many others...

You may also add MongoDB and etcd to the list.

Plugins attached to datastore communicate with each other indirectly via the datastore's pubsub feature.

###The GW's role
- The construct is sort of clustering (ACT-ACT).
- OpenDaylight's CRUD/DCN is seen as MESSAGE on Redis.
- The GW subscribes channels on MD-SAL and Redis for example.
- The GW works as a pubsub relay and data model translator: translation between your data model schema (e.g., defined in your Java classes) and YANG Java binding generated by ODL YANG Tools.
- The data on Your SDN controller's datastore are synchronized with MD-SAL datastore via the GW.
- Users may use both your SDN controller's N.B. API and OpenDaylight's RESTCONF API.

##Coodination of SDN controllers
If everythings work in a same container (such as Karaf container), things are easy. If not, you may need to use something like ZooKeeper or etcd (or MD-SAL?) for coordinating SDN controllers.

Recommendation 1:

1. Run you SDN controller as a Karaf feature (a combination of OSGi bundles) and OpenDaylight in a same Karaf container (i.e., on a same JVM).
2. Use "embedded" pubsub server or develop a pubsub capability on your own, and avoid using an external pubsub server (such as Redis).

```
+------------+
| [Feature]  |
| [Feature]  |
| [Feature]  |
+------------+
Karaf OSGi container (limited to Java)
```

Recommendation 2:

But, wait! What if you like Python or Golang to develop your SDN controller? In this case, OSGi becomes meaningless and another choice is to use a PaaS infrastructure and chose your favorite pubsub or MQ (Redis, RabbitMQ, ActiveMQ etc) and database (SQL or NoSQL). PaaS also supports rolling update and load balancer capabilites required for a commercial deployment.

```
[Feature]  [Feature]  [Feature]
Container  Container  Container
    |          |          |
   -+------+---+----------+-- pubsub or MQ
           |
 [router/load balancer]
           |
   production network

Linux Container for every feature
```

##HA(High-availability)

- A cluster of MD-SAL (three nodes)
- Instances of your SDN controller are attached to the cluster
- All the instances share the same view of data
```
                                MD-SAL clustering (RAFT-based)
[Instance A of your SDN controller]---[MD-SAL]--[MD-SAL]---[Instance B of your SDN controller]
                                            |    |
                                           [MD-SAL]
                                              |
                              [Instance C of your SDN controller]
```

##Transaction/Rollback

Consider how to implement transaction/rollback.

Is this API still valid? https://git.opendaylight.org/gerrit/#/c/12912/9

##Your SDN controller is sort of a southbound plugin for MD-SAL

Compare!
```
          [MD-SAL]                         [MD-SAL]
             |                                |
    [Your SDN controller]                 [Driver]
             |                                |
    [Your networking equipment]   [Your networking equipment]
```
You must have noticed that there are no differences between the above two.

SDN is about synchronizing data between MD-SAL and networking equipment.

What about this?
```
          [MD-SAL]                         [MD-SAL]
             |                                |
             X Disconnected               [Driver]
             |                                |
    [Your SDN controller]                     X Disconnected
             |                                |
    [Your networking equipment]   [Your networking equipment]
```
Network partition (split-brain case) causes data conflict (out of sync) between MD-SAL and your SDN controller or MD-SAL and networking equipment, and that is something we have to take into account seriously.
